<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<title>HKMCäº‘</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    * {
      box-sizing: border-box;
    }
    
    body {
      margin: 0;
      font-family: "Microsoft YaHei", Arial, sans-serif;
      background: #f5f5f5;
      color: #222;
    }
    
    a {
      text-decoration: none;
      color: inherit;
    }
    
    .container {
      width: 1180px;
      max-width: 95%;
      margin: 0 auto;
    }
    
    /* å¤´éƒ¨ */
    header {
      background: #ffffff;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .header {
      height: 68px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .logo img {
      height: 45px;
      display: block;
    }
    
    .nav a {
      margin-left: 28px;
      font-size: 14px;
      color: #333;
      transition: color 0.3s;
    }
    
    .nav a:hover {
      color: #000;
    }
    
    /* banner */
    .banner {
      background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
      color: #fff;
      padding: 60px 0;
      border-radius: 16px;
      margin: 20px auto;
      max-width: 95%;
    }
    
    .banner-wrap {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 30px;
    }
    
    .banner h1 {
      font-size: 36px;
      margin: 0 0 12px;
      font-weight: 600;
    }
    
    .banner p {
      font-size: 16px;
      margin: 0;
      color: #e0e0e0;
    }
    
    .banner ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .banner li {
      margin-bottom: 10px;
      font-size: 15px;
      color: #f0f0f0;
      padding-left: 20px;
      position: relative;
    }
    
    .banner li:before {
      content: "âœ“";
      position: absolute;
      left: 0;
      color: #4CAF50;
      font-weight: bold;
    }
    
    /* äº§å“åŒº */
    .products {
      background: #ffffff;
      padding: 40px 0;
      border-radius: 16px;
      margin: 20px auto;
      max-width: 95%;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .product {
      border-bottom: 1px solid #f0f0f0;
      padding: 30px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      transition: background 0.3s;
      border-radius: 8px;
      padding-left: 20px;
      padding-right: 20px;
    }
    
    .product:hover {
      background: #fafafa;
    }
    
    .product:last-child {
      border-bottom: none;
    }
    
    .product h2 {
      margin: 0 0 8px;
      font-size: 22px;
      color: #000;
      font-weight: 600;
    }
    
    .product p {
      margin: 0;
      font-size: 14px;
      color: #666;
    }
    
    .product a {
      border: 2px solid #000;
      color: #000;
      padding: 10px 28px;
      font-size: 14px;
      border-radius: 8px;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .product a:hover {
      background: #000;
      color: #fff;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    /* ä¼˜åŠ¿ */
    .adv {
      background: #ffffff;
      padding: 40px 0;
      border-radius: 16px;
      margin: 20px auto;
      max-width: 95%;
      box-shadow: 0 2px 12px rgba(0,0,0,0.08);
    }
    
    .adv ul {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .adv li {
      background: #fafafa;
      border: 1px solid #e5e5e5;
      padding: 22px;
      flex: 1;
      min-width: 220px;
      font-size: 14px;
      border-radius: 12px;
      transition: all 0.3s;
    }
    
    .adv li:hover {
      border-color: #000;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transform: translateY(-3px);
    }
    
    /* footer */
    footer {
      background: #ffffff;
      border-top: 1px solid #e0e0e0;
      padding: 30px 0 20px;
      font-size: 13px;
      color: #666;
      text-align: center;
      margin-top: 40px;
    }
    
    .footer-links {
      margin-bottom: 12px;
      line-height: 1.8;
    }
    
    .footer-links a {
      color: #666;
      transition: color 0.3s;
    }
    
    .footer-links a:hover {
      color: #000;
    }
    
    /* å¼¹çª—é®ç½© */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 20px;
    }
    
    .modal-overlay.hidden {
      display: none;
    }
    
    /* å¼¹çª—å®¹å™¨ */
    .modal-container {
      background: #ffffff;
      border-radius: 16px;
      width: 90%;
      max-width: 900px;
      max-height: 85vh;
      display: flex;
      flex-direction: row;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    
    /* ä¾§è¾¹æ  */
    .modal-sidebar {
      width: 200px;
      background: #f8f8f8;
      border-right: 1px solid #e0e0e0;
      padding: 20px 0;
      overflow-y: auto;
      flex-shrink: 0;
    }
    
    .modal-sidebar-item {
      padding: 12px 20px;
      cursor: pointer;
      font-size: 14px;
      color: #666;
      border-left: 3px solid transparent;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .modal-sidebar-item:hover {
      background: #f0f0f0;
      color: #000;
    }
    
    .modal-sidebar-item.active {
      background: #ffffff;
      color: #000;
      border-left-color: #000;
      font-weight: 500;
    }
    
    .modal-sidebar-item.read {
      color: #999;
    }
    
    .modal-sidebar-item .status-icon {
      font-size: 12px;
    }
    
    /* ä¸»å†…å®¹åŒºåŸŸ */
    .modal-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    /* å¼¹çª—å†…å®¹åŒºåŸŸ */
    .modal-content {
      padding: 35px 40px;
      overflow-y: auto;
      flex: 1;
    }
    
    .modal-content::-webkit-scrollbar {
      width: 8px;
    }
    
    .modal-content::-webkit-scrollbar-track {
      background: #f5f5f5;
      border-radius: 4px;
    }
    
    .modal-content::-webkit-scrollbar-thumb {
      background: #bbb;
      border-radius: 4px;
    }
    
    .modal-content::-webkit-scrollbar-thumb:hover {
      background: #999;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 600;
      color: #000;
      margin: 0 0 25px 0;
      text-align: center;
    }
    
    .modal-text {
      font-size: 15px;
      line-height: 1.8;
      color: #333;
      margin-bottom: 20px;
    }
    
    .modal-details {
      background: #fafafa;
      border-radius: 12px;
      padding: 20px 25px;
      margin: 20px 0;
    }
    
    .modal-details h3 {
      font-size: 16px;
      font-weight: 600;
      color: #000;
      margin: 0 0 15px 0;
    }
    
    .modal-details ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .modal-details li {
      padding: 8px 0;
      font-size: 14px;
      color: #444;
      border-bottom: 1px solid #e8e8e8;
    }
    
    .modal-details li:last-child {
      border-bottom: none;
    }
    
    .modal-details strong {
      color: #000;
      font-weight: 600;
      display: inline-block;
      min-width: 90px;
    }
    
    .modal-content ul {
      background: #fafafa;
      border-radius: 12px;
      padding: 20px 25px 20px 45px;
      margin: 20px 0;
      list-style: disc;
    }
    
    .modal-content ul li {
      padding: 8px 0;
      font-size: 14px;
      color: #444;
      border-bottom: 1px solid #e8e8e8;
      list-style: disc;
    }
    
    .modal-content ul li:last-child {
      border-bottom: none;
    }
    
    .modal-content h3 {
      font-size: 16px;
      font-weight: 600;
      color: #000;
      margin: 20px 0 15px 0;
    }
    
    .notice-footer {
      font-size: 14px;
      color: #666;
      line-height: 1.7;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #e8e8e8;
    }
    
    /* åº•éƒ¨å›ºå®šåŒºåŸŸ */
    .modal-bottom {
      background: #ffffff;
      padding: 20px 40px 25px;
      border-top: 1px solid #e8e8e8;
    }
    
    .checkbox-wrapper {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      user-select: none;
      gap: 15px;
    }
    
    .checkbox-left {
      display: flex;
      align-items: center;
      cursor: pointer;
      font-size: 14px;
      color: #666;
      gap: 10px;
    }
    
    .checkbox-wrapper input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
      flex-shrink: 0;
    }
    
    .modal-button {
      width: 100%;
      padding: 14px;
      background: #d5d5d5;
      color: #999;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 500;
      cursor: not-allowed;
      transition: all 0.3s;
    }
    
    .modal-button.active {
      background: #000;
      color: #fff;
      cursor: pointer;
    }
    
    .modal-button.active:hover {
      background: #333;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    .scroll-hint {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 13px;
      color: #666;
    }
    
    .scroll-hint span {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .banner h1 { font-size: 28px; }
      .modal-content { padding: 25px 20px; }
      .modal-bottom { padding: 15px 20px 20px; }
      .modal-details { padding: 15px 18px; }
      .checkbox-wrapper { flex-wrap: wrap; }
      .scroll-hint { width: 100%; justify-content: center; margin-top: 10px; }
      .modal-container { max-width: 95%; }
      .modal-sidebar { display: none; }
      .modal-container { flex-direction: column; }
    }
</style>
</head>

<body>

<!-- å…¬å‘Šå¼¹çª— -->
<div class="modal-overlay" id="noticeModal" style="display: none;">
  <div class="modal-container">
    <!-- ä¾§è¾¹æ  -->
    <div class="modal-sidebar" id="modalSidebar">
      <!-- å…¬å‘Šåˆ—è¡¨å°†åŠ¨æ€ç”Ÿæˆ -->
    </div>
    
    <!-- ä¸»å†…å®¹åŒº -->
    <div class="modal-main">
      <div class="modal-content" id="modalContent">
        <!-- å…¬å‘Šå†…å®¹å°†ä» gonggao.md åŠ¨æ€åŠ è½½ -->
      </div>
      
      <div class="modal-bottom">
        <div class="checkbox-wrapper">
          <label class="checkbox-left" for="readConfirm">
            <input type="checkbox" id="readConfirm">
            æˆ‘å·²è®¤çœŸé˜…è¯»å®Œæ•´å…¬å‘Šå†…å®¹
          </label>
          <div class="scroll-hint" id="scrollHint">
            <span>ğŸ‘† è¯·å…ˆæ»šåŠ¨åˆ°åº•é˜…è¯»å®Œæ•´å†…å®¹</span>
          </div>
        </div>
        <button class="modal-button" id="closeBtn" disabled>è¯·é˜…è¯»å¹¶ç­‰å¾… (<span id="countdown">8</span>s)</button>
      </div>
    </div>
  </div>
</div>

<header>
  <div class="container header">
    <div class="logo">
      <img src="https://aliyun-oss-bucket.d-dos.cc/HKMC_logo.jpg" alt="HKMCäº‘">
    </div>
    <div class="nav">
      <a href="#">é¦–é¡µ</a>
      <a href="https://qm.qq.com/q/5vhRxkZIHu">å®˜æ–¹QQç¾¤</a>
      <a href="https://miaoju.top/" target="_blank" rel="noopener">å–µèš</a>
      <a href="/login">ç™»å½•</a>
      <a href="/register">æ³¨å†Œ</a>
    </div>
  </div>
</header>

<div class="banner">
  <div class="container banner-wrap">
    <div>
      <h1>ç¨³å®š Â· å®ç”¨ Â· æœåŠ¡å™¨æœåŠ¡</h1>
      <p>äº‘æœåŠ¡å™¨ / æŒ‚æœºå® / è™šæ‹Ÿä¸»æœº / CDN</p>
    </div>
    <ul>
      <li>é•¿æœŸç¨³å®šè¿è¡Œ</li>
      <li>ä»·æ ¼æ¸…æ™°é€æ˜</li>
      <li>å³ä¹°å³ç”¨</li>
    </ul>
  </div>
</div>

<div class="products">
  <div class="container">
    <div class="product">
      <div>
        <h2>äº‘æœåŠ¡å™¨</h2>
        <p>é€‚åˆç½‘ç«™ã€ç¨‹åºã€ä¸šåŠ¡éƒ¨ç½²</p>
      </div>
      <a href="/order/">ç«‹å³è´­ä¹°</a>
    </div>

    <div class="product">
      <div>
        <h2>æŒ‚æœºå®</h2>
        <p>ä½ä»·ç¨³å®šï¼Œé€‚åˆé•¿æœŸæŒ‚æœº</p>
      </div>
      <a href="/order/">ç«‹å³è´­ä¹°</a>
    </div>

    <div class="product">
      <div>
        <h2>è™šæ‹Ÿä¸»æœº</h2>
        <p>å³å¼€å³ç”¨ï¼Œå»ºç«™é¦–é€‰</p>
      </div>
      <a href="/order/">ç«‹å³è´­ä¹°</a>
    </div>

    <div class="product">
      <div>
        <h2>CDN åŠ é€Ÿ</h2>
        <p>æå‡è®¿é—®é€Ÿåº¦ï¼Œå‡è½»æºç«™å‹åŠ›</p>
      </div>
      <a href="/order/">ç«‹å³è´­ä¹°</a>
    </div>
  </div>
</div>

<div class="adv">
  <div class="container">
    <ul>
      <li>ä¸“æ³¨æœåŠ¡å™¨ä¸åŸºç¡€äº‘æœåŠ¡</li>
      <li>ä¸æå¤æ‚æ¦‚å¿µï¼Œç®€å•å¥½ç”¨</li>
      <li>é€‚åˆä¸ªäººä¸å·¥ä½œå®¤é•¿æœŸä½¿ç”¨</li>
    </ul>
  </div>
</div>

<footer>
  <div class="footer-links">
    å‹æƒ…é“¾æ¥ï¼š<a href="https://miaoju.top/" target="_blank" rel="noopener">å–µèšå¼¹å¹•ç½‘</a> | 
    <a href="https://www.io.hk.cn/">ç«™é•¿åšå®¢</a><br>
    æœ¬é¡µé¢æºä»£ç :<a href="https://github.com/hekuo5310/HKMCMF/" target="_blank" rel="noopener" style="color: blue;">Github</a><br>
    <a href="https://beian.miit.gov.cn/" target="_blank">é—½ICPå¤‡2025112803å·-1</a> | 
    <a href="https://www.rainyun.com/hekuo_?s=cloud/">æœ¬ç«™ç”±é›¨äº‘æä¾›è®¡ç®—æœåŠ¡</a> | 
    <a href="https://icp.6uu.us/query.php?icp_number=%E5%85%83-80320/" target="_blank" rel="noopener noreferrer">å…ƒ-80320</a>
  </div>
  Â© <span id="y"></span> hekuo Â· All Rights Reserved
</footer>

<script>
// å¹´ä»½
document.getElementById("y").textContent = new Date().getFullYear();

// Cookie æ“ä½œå‡½æ•°
function setCookie(name, value, days) {
  const d = new Date();
  d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
  const expires = "expires=" + d.toUTCString();
  document.cookie = name + "=" + value + ";" + expires + ";path=/";
}

function getCookie(name) {
  const nameEQ = name + "=";
  const ca = document.cookie.split(';');
  for(let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') c = c.substring(1, c.length);
    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
  }
  return null;
}

// Markdown æ¸²æŸ“å‡½æ•°ï¼ˆç®€åŒ–ç‰ˆï¼‰
function renderMarkdown(md) {
  let html = md.trim();
  
  // å…ˆå¤„ç†ä»£ç å—ï¼ˆé¿å…è¢«å…¶ä»–è§„åˆ™å½±å“ï¼‰
  const codeBlocks = [];
  html = html.replace(/```([\s\S]*?)```/g, (match, code) => {
    codeBlocks.push(code);
    return `__CODE_BLOCK_${codeBlocks.length - 1}__`;
  });
  
  // åˆ†å‰²æˆè¡Œå¤„ç†
  const lines = html.split('\n');
  const processed = [];
  let inList = false;
  let currentParagraph = [];
  let skippedLines = 0; // è®¡æ•°å·²è·³è¿‡çš„éç©ºè¡Œæ•°ï¼ˆå‰ä¸¤è¡Œï¼šæ ‡é¢˜+æ—¶é—´ï¼‰
  
  for (let i = 0; i < lines.length; i++) {
    const line = lines[i].trim();
    
    // è·³è¿‡å‰ä¸¤ä¸ªéç©ºè¡Œï¼ˆç¬¬ä¸€è¡Œæ ‡é¢˜ã€ç¬¬äºŒè¡Œæ—¶é—´ï¼‰
    if (skippedLines < 2) {
      if (line !== '') {
        skippedLines++;
        continue;
      }
      // ç©ºè¡Œä¹Ÿè·³è¿‡ï¼ˆæ ‡é¢˜å’Œæ—¶é—´ä¹‹é—´å¯èƒ½æœ‰ç©ºè¡Œï¼‰
      continue;
    }
    
    // ç©ºè¡Œ - ç»“æŸå½“å‰æ®µè½
    if (line === '') {
      if (currentParagraph.length > 0) {
        processed.push('<p class="modal-text">' + currentParagraph.join('<br>') + '</p>');
        currentParagraph = [];
      }
      if (inList) {
        processed.push('</ul>');
        inList = false;
      }
      continue;
    }
    
    // æ ‡é¢˜
    if (line.match(/^### /)) {
      if (currentParagraph.length > 0) {
        processed.push('<p class="modal-text">' + currentParagraph.join('<br>') + '</p>');
        currentParagraph = [];
      }
      if (inList) {
        processed.push('</ul>');
        inList = false;
      }
      processed.push('<h3>' + line.replace(/^### /, '') + '</h3>');
      continue;
    }
    
    if (line.match(/^## /)) {
      if (currentParagraph.length > 0) {
        processed.push('<p class="modal-text">' + currentParagraph.join('<br>') + '</p>');
        currentParagraph = [];
      }
      if (inList) {
        processed.push('</ul>');
        inList = false;
      }
      processed.push('<h2 class="modal-title">' + line.replace(/^## /, '') + '</h2>');
      continue;
    }
    
    if (line.match(/^# /)) {
      if (currentParagraph.length > 0) {
        processed.push('<p class="modal-text">' + currentParagraph.join('<br>') + '</p>');
        currentParagraph = [];
      }
      if (inList) {
        processed.push('</ul>');
        inList = false;
      }
      processed.push('<h1>' + line.replace(/^# /, '') + '</h1>');
      continue;
    }
    
    // åˆ—è¡¨é¡¹
    if (line.match(/^\* /)) {
      if (currentParagraph.length > 0) {
        processed.push('<p class="modal-text">' + currentParagraph.join('<br>') + '</p>');
        currentParagraph = [];
      }
      if (!inList) {
        processed.push('<ul>');
        inList = true;
      }
      processed.push('<li>' + line.replace(/^\* /, '') + '</li>');
      continue;
    }
    
    // æ™®é€šæ–‡æœ¬è¡Œ
    if (inList) {
      processed.push('</ul>');
      inList = false;
    }
    currentParagraph.push(line);
  }
  
  // å¤„ç†æœ€åçš„æ®µè½
  if (currentParagraph.length > 0) {
    processed.push('<p class="modal-text">' + currentParagraph.join('<br>') + '</p>');
  }
  if (inList) {
    processed.push('</ul>');
  }
  
  html = processed.join('\n');
  
  // ç²—ä½“å¤„ç†
  html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
  
  // æ¢å¤ä»£ç å—
  codeBlocks.forEach((code, i) => {
    html = html.replace(`__CODE_BLOCK_${i}__`, `<pre><code>${code}</code></pre>`);
  });
  
  return html;
}

// å¼¹çª—é€»è¾‘
const modal = document.getElementById('noticeModal');
const modalSidebar = document.getElementById('modalSidebar');
const modalContent = document.getElementById('modalContent');
const scrollHint = document.getElementById('scrollHint');
const checkbox = document.getElementById('readConfirm');
const closeBtn = document.getElementById('closeBtn');
const countdownSpan = document.getElementById('countdown');

let countdown = 8;
let isScrolledToBottom = false;
let countdownInterval;
let allNotices = [];
let noticeInfoList = []; // å­˜å‚¨è§£æå‡ºçš„å…¬å‘Šä¿¡æ¯ï¼ˆæ ‡é¢˜ã€æ—¶é—´ï¼‰
let currentNoticeIndex = 0;
let readStatus = []; // è®°å½•æ¯æ¡å…¬å‘Šçš„é˜…è¯»çŠ¶æ€
let globalCountdownDone = false; // å…¨å±€å€’è®¡æ—¶æ˜¯å¦å·²å®Œæˆ

// è§£ææ¯æ¡å…¬å‘Šçš„ç¬¬äºŒè¡Œæ—¶é—´ï¼Œè¿”å› {title, time, timeStamp}
function parseNoticeInfo(notice) {
  const lines = notice.trim().split('\n');
  let title = '';
  let time = '';
  let timeStamp = 0;

  // ç¬¬ä¸€è¡Œï¼š# æ ‡é¢˜
  if (lines[0] && lines[0].match(/^#\s+/)) {
    title = lines[0].replace(/^#\s+/, '').trim();
  }

  // ç¬¬äºŒè¡Œï¼šæ—¶é—´ 2025/02/03 13:02:15
  if (lines[1]) {
    const t = lines[1].trim();
    // åŒ¹é… YYYY/MM/DD HH:MM:SS
    if (t.match(/^\d{4}\/\d{2}\/\d{2}\s+\d{2}:\d{2}:\d{2}$/)) {
      time = t;
      // è½¬æ¢ä¸º Date èƒ½è§£æçš„æ ¼å¼
      timeStamp = new Date(t.replace(/\//g, '-')).getTime();
    }
  }

  return { title, time, timeStamp };
}

// åŠ è½½ gonggao.md å¹¶åˆ¤æ–­æ˜¯å¦éœ€è¦å¼¹å‡º
fetch('./themes/web/HKMC/gonggao.md')
  .then(response => {
    if (!response.ok) throw new Error('å…¬å‘Šæ–‡ä»¶ä¸å­˜åœ¨');
    return response.text();
  })
  .then(mdContent => {
    const notices = mdContent.split(/\n---\n|\n\*\*\*\n/).filter(n => n.trim());
    if (notices.length === 0) throw new Error('æ²¡æœ‰å…¬å‘Šå†…å®¹');

    // è§£ææ‰€æœ‰å…¬å‘Šä¿¡æ¯
    const infoList = notices.map(n => parseNoticeInfo(n));

    // è·å–æ‰€æœ‰å…¬å‘Šä¸­æœ€æ–°çš„æ—¶é—´æˆ³
    const maxTime = Math.max(...infoList.map(i => i.timeStamp));

    // è·å– cookie é‡Œçš„æ—¶é—´æˆ³
    const lastRead = getCookie('notice_last_read');
    const cookieTime = lastRead ? parseInt(lastRead) : 0;

    // åªæœ‰å…¬å‘Šæœ€æ–°æ—¶é—´ > cookie æ—¶é—´ï¼Œæ‰å¼¹å‡º
    if (maxTime <= cookieTime) {
      throw new Error('æ²¡æœ‰æ–°å…¬å‘Š');
    }

    allNotices = notices;
    noticeInfoList = infoList;
    readStatus = new Array(notices.length).fill(false);

    generateSidebar();
    showNotice(0);
    startGlobalCountdown();
    modal.style.display = 'flex';
  })
  .catch(error => {
    console.log('æ— éœ€æ˜¾ç¤ºå…¬å‘Š:', error.message);
    modal.style.display = 'none';
  });

// ç”Ÿæˆä¾§è¾¹æ 
function generateSidebar() {
  modalSidebar.innerHTML = '';
  
  allNotices.forEach((notice, index) => {
    const info = noticeInfoList[index];
    const title = info.title || `å…¬å‘Š ${index + 1}`;
    const time = info.time || '';
    
    const item = document.createElement('div');
    item.className = 'modal-sidebar-item';
    item.dataset.index = index;
    
    // å·¦ä¾§ï¼šçŠ¶æ€å›¾æ ‡ + æ ‡é¢˜+æ—¶é—´
    const leftWrap = document.createElement('div');
    leftWrap.style.cssText = 'display:flex;align-items:flex-start;gap:8px;flex:1;min-width:0;';
    
    const statusIcon = document.createElement('span');
    statusIcon.className = 'status-icon';
    statusIcon.style.cssText = 'flex-shrink:0;margin-top:2px;';
    statusIcon.textContent = readStatus[index] ? 'âœ“' : 'â—‹';
    
    // æ ‡é¢˜ + æ—¶é—´çš„å®¹å™¨
    const textWrap = document.createElement('div');
    textWrap.style.cssText = 'min-width:0;';
    
    const titleText = document.createElement('div');
    titleText.style.cssText = 'white-space:nowrap;overflow:hidden;text-overflow:ellipsis;';
    titleText.textContent = title;
    titleText.title = title;
    
    textWrap.appendChild(titleText);
    
    // æ—¶é—´æ˜¾ç¤º
    if (time) {
      const timeText = document.createElement('div');
      timeText.style.cssText = 'font-size:11px;color:#aaa;margin-top:2px;';
      timeText.textContent = time;
      textWrap.appendChild(timeText);
    }
    
    leftWrap.appendChild(statusIcon);
    leftWrap.appendChild(textWrap);
    item.appendChild(leftWrap);
    
    item.addEventListener('click', () => {
      showNotice(index);
    });
    
    if (index === currentNoticeIndex) {
      item.classList.add('active');
    }
    
    if (readStatus[index]) {
      item.classList.add('read');
    }
    
    modalSidebar.appendChild(item);
  });
}

// æ˜¾ç¤ºæŒ‡å®šå…¬å‘Š
function showNotice(index) {
  if (index >= allNotices.length || index < 0) {
    return;
  }
  
  currentNoticeIndex = index;
  const noticeHtml = renderMarkdown(allNotices[index]);
  modalContent.innerHTML = noticeHtml;
  
  // æ›´æ–°ä¾§è¾¹æ çŠ¶æ€
  document.querySelectorAll('.modal-sidebar-item').forEach((item, i) => {
    if (i === index) {
      item.classList.add('active');
    } else {
      item.classList.remove('active');
    }
  });
  
  // é‡ç½®çŠ¶æ€
  isScrolledToBottom = false;
  checkbox.checked = false;
  closeBtn.disabled = true;
  closeBtn.classList.remove('active');
  scrollHint.style.display = 'inline-flex';
  
  // æ»šåŠ¨åˆ°é¡¶éƒ¨
  modalContent.scrollTop = 0;
  
  // æ£€æŸ¥æ˜¯å¦éœ€è¦æ»šåŠ¨ï¼ˆå†…å®¹æ˜¯å¦è¶…å‡ºï¼‰
  checkScrollNeeded();
  
  // æ›´æ–°æŒ‰é’®æ–‡æœ¬ï¼ˆä¸å¯åŠ¨æ–°çš„å€’è®¡æ—¶ï¼‰
  if (globalCountdownDone) {
    closeBtn.textContent = 'è¯·ç¡®è®¤"æˆ‘å·²è®¤çœŸé˜…è¯»å®Œæ•´å…¬å‘Šå†…å®¹"';
  } else {
    // å€’è®¡æ—¶è¿˜åœ¨è¿›è¡Œä¸­ï¼Œä¿æŒå€’è®¡æ—¶æ˜¾ç¤º
    closeBtn.innerHTML = 'è¯·é˜…è¯»å¹¶ç­‰å¾… (<span id="countdown">' + countdown + '</span>s)';
  }
  
  checkEnableButton();
}

// å¯åŠ¨å…¨å±€å€’è®¡æ—¶ï¼ˆåªè°ƒç”¨ä¸€æ¬¡ï¼‰
function startGlobalCountdown() {
  countdown = 8;
  closeBtn.innerHTML = 'è¯·é˜…è¯»å¹¶ç­‰å¾… (<span id="countdown">8</span>s)';
  
  const countdownSpan = document.getElementById('countdown');
  
  countdownInterval = setInterval(function() {
    countdown--;
    if (countdownSpan) countdownSpan.textContent = countdown;
    
    if (countdown === 0) {
      clearInterval(countdownInterval);
      globalCountdownDone = true;
      closeBtn.textContent = 'è¯·ç¡®è®¤"æˆ‘å·²è®¤çœŸé˜…è¯»å®Œæ•´å…¬å‘Šå†…å®¹"';
      checkEnableButton();
    }
  }, 1000);
}

// æ£€æŸ¥å†…å®¹æ˜¯å¦éœ€è¦æ»šåŠ¨
function checkScrollNeeded() {
  const needsScroll = modalContent.scrollHeight > modalContent.clientHeight;
  if (!needsScroll) {
    // å†…å®¹ä¸éœ€è¦æ»šåŠ¨ï¼Œç›´æ¥æ ‡è®°ä¸ºå·²æ»šåŠ¨åˆ°åº•
    isScrolledToBottom = true;
  }
}

// æ£€æµ‹æ˜¯å¦æ»šåŠ¨åˆ°åº•éƒ¨
modalContent.addEventListener('scroll', function() {
  const scrollTop = modalContent.scrollTop;
  const scrollHeight = modalContent.scrollHeight;
  const clientHeight = modalContent.clientHeight;
  
  // å…è®¸5pxçš„è¯¯å·®
  if (scrollTop + clientHeight >= scrollHeight - 5) {
    isScrolledToBottom = true;
    checkEnableButton();
  }
});

// å¤é€‰æ¡†å˜åŒ–
checkbox.addEventListener('change', checkEnableButton);

// æ£€æŸ¥æ˜¯å¦å¯ä»¥å¯ç”¨æŒ‰é’®
function checkEnableButton() {
  if (isScrolledToBottom && checkbox.checked && globalCountdownDone) {
    closeBtn.disabled = false;
    closeBtn.classList.add('active');
    
    // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æœªè¯»å…¬å‘Š
    const hasUnread = readStatus.some((status, index) => !status && index !== currentNoticeIndex);
    
    if (hasUnread) {
      closeBtn.textContent = 'ç¡®è®¤å¹¶ç»§ç»­';
    } else {
      closeBtn.textContent = 'æˆ‘å·²å…¨éƒ¨çŸ¥æ™“';
    }
  }
}

// å…³é—­å¼¹çª—æˆ–æ˜¾ç¤ºä¸‹ä¸€æ¡
closeBtn.addEventListener('click', function() {
  console.log('æŒ‰é’®è¢«ç‚¹å‡»ï¼ŒdisabledçŠ¶æ€:', closeBtn.disabled);
  
  if (!closeBtn.disabled) {
    // æ ‡è®°å½“å‰å…¬å‘Šä¸ºå·²è¯»
    readStatus[currentNoticeIndex] = true;
    console.log('å½“å‰å…¬å‘Šå·²æ ‡è®°ä¸ºå·²è¯»ï¼ŒreadStatus:', readStatus);
    generateSidebar();
    
    // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å…¬å‘Šéƒ½å·²è¯»
    const allRead = readStatus.every(status => status);
    console.log('æ‰€æœ‰å…¬å‘Šå·²è¯»ï¼Ÿ', allRead);
    
    if (allRead) {
      // æ‰€æœ‰å…¬å‘Šå·²è¯»å®Œï¼Œå­˜å‚¨å½“å‰æ—¶é—´åˆ°cookie
      console.log('æ‰€æœ‰å…¬å‘Šå·²è¯»ï¼Œå…³é—­å¼¹çª—');
      setCookie('notice_last_read', new Date().getTime().toString(), 365);
      modal.classList.add('hidden');
      modal.style.display = 'none';
    } else {
      // æ‰¾åˆ°ä¸‹ä¸€ä¸ªæœªè¯»å…¬å‘Š
      let nextIndex = -1;
      for (let i = 0; i < readStatus.length; i++) {
        if (!readStatus[i]) {
          nextIndex = i;
          break;
        }
      }
      
      if (nextIndex !== -1) {
        showNotice(nextIndex);
      }
    }
  }
});

// é˜²æ­¢ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
modal.addEventListener('click', function(e) {
  if (e.target === modal) {
    // å¯é€‰ï¼šæ·»åŠ æŠ–åŠ¨æ•ˆæœæç¤ºç”¨æˆ·å¿…é¡»é˜…è¯»
    document.querySelector('.modal-container').style.animation = 'shake 0.5s';
    setTimeout(() => {
      document.querySelector('.modal-container').style.animation = '';
    }, 500);
  }
});
</script>

</body>
</html>